# UX_Spec：本地服装生图工作台（交接给 UI）

## 0. 设计原则（MVP）
- KISS：单页主流程 + 少量弹窗；避免多层级信息架构
- 可控优先：用户能看到“参考图 + 锁定点 + Prompt + 版本”
- 默认人工兜底：自动只是建议；最终以人工“通过/修复”判断
- 只改衣服：修复流程所有文案与交互都围绕“衣服细节一致性”

## 1. 信息架构（IA）
- 任务列表（Home）
- 新建任务（New Task）
- 任务详情（Task Detail，包含：计划/出图/质检/版本）
- 设置（Settings：API Key / Base URL / 默认输出）

## 2. 核心对象（用于页面字段命名一致）
- 任务 Task：一套衣服 + 一组 Shots + 一组输出图
- 参考图 Refs：衣服图（图A~图N）、face_ref（可选）
- GARMENT LOCK：仅“能从参考图确认”的锁定点清单（可编辑）
- Shot：每张图的一行策划（动作/卖点/镜头/Prompt）
- 输出版本：原始生成（v1）/ 修复生成（v2/v3…）

## 3. P0 流程（Flows）

### Flow A：新建任务 → 生成计划（Shot List）
1) 在【新建任务】上传衣服图（至少 1 张）与可选 face_ref
2) 填写需求：平台/用途、风格关键词、统一大场景、张数、动作偏好（可选）
3) 点击【生成计划】进入 loading
4) 成功：进入【任务详情-计划】展示结构化结果（含 GARMENT LOCK + Shot List 表格）
5) 异常：展示错误原因与【重试】；保留已填表单

### Flow B：确认计划 → 逐张生图
1) 在【任务详情-计划】用户可编辑 GARMENT LOCK 与 Shot 行（Prompt 可展开预览）
2) 点击【开始出图】进入【任务详情-出图】并开始逐张生成（可队列）
3) 每个 Shot 有状态：未生成/生成中/成功/失败
4) 单张失败：允许【重试本张】；不影响已成功的其他张

### Flow C：人工质检 →（可选）修复闭环
1) 在【任务详情-质检】逐张查看：左侧参考图、右侧当前输出图
2) 用户选择：
   - 【通过】：该 Shot 进入已通过
   - 【需要修复】：打开【修复弹窗】
3) 修复弹窗（两步，均可人工确认）：
   - Step1【生成修复方案】：输出“不一致清单 + 修复指令草稿（英文）”，可编辑/勾选
   - Step2【执行修复】：调用改图生成新版本，生成后默认回到弹窗展示对比
4) 用户可【通过】或【继续修复】（建议最多 1~2 次，超过提示改为“重生本张”）

### Flow D：导出
- 支持：单张下载 PNG、整任务打包下载（含 Prompt/参数/版本信息）

## 4. 页面规格（Screens）

### S1：任务列表（Home）
**目的**：快速进入最近任务、创建新任务  
**主要组件**
- 顶部：标题“本地生图工作台”、【新建任务】按钮、【设置】入口
- 列表：任务卡片（创建时间、平台/风格、大场景、Shots 数、状态、最后更新）
- 空状态：引导文案 + 示例
**状态**
- Empty：无任务 → “还没有任务，先创建一个吧”
- Loading：本地读取
- Error：读取失败 → “读取失败，刷新重试”

### S2：新建任务（New Task）
**目的**：收集输入与需求参数，启动“生成计划”  
**表单分区**
1) 上传区
   - 衣服参考图：支持多张；自动编号图A~图N；展示缩略图与可删除
   - face_ref（可选）：单张；标记为 face_ref
2) 需求区
   - 用途/平台：默认“小红书发图”
   - 风格关键词：输入框（例：潮牌/高街）
   - 统一大场景：输入或下拉（例：街头）
   - 张数 N：默认 4
   - 动作偏好：可选（1~N 行输入）
   - 约束（默认勾选）：不新增 logo / 不出现可读文字招牌 / 不二维码 / 背景干净 / 统一搭配不更换
   - NEG：默认 OFF（关闭时不生成 avoid 文案）
3) 行为区
   - 主按钮：【生成计划】
   - 次按钮：【保存草稿】（可选，P0 可不做）
**校验与文案**
- 未上传衣服图：按钮置灰 + “至少上传 1 张衣服参考图”
- 超过建议张数：提示但不强拦（“为稳定建议≤5张高保真参考图，系统将优先选取关键图”）

### S3：任务详情（Task Detail）
建议用 Stepper（可点击回到上一步）：`计划 → 出图 → 质检 → 导出`

#### S3-1：计划（Plan）
**布局**
- 左：参考图墙（图A~图N、face_ref）
- 右：结构化结果
  - 区块1：服装识别档案（只读）
  - 区块2：GARMENT LOCK（可编辑清单：新增/删除/排序）
  - 区块3：Shot List 表格（N 行，列与系统模板一致；每行可展开 Prompt）
**关键交互**
- 【开始出图】（主 CTA）
- 单行操作：复制 Prompt、编辑该行、追加“本行覆盖锁定点（1~3条）”

#### S3-2：出图（Render）
**布局**
- 上：进度条（已完成/总数）、队列状态
- 下：Shot 网格或表格（每行：缩略图、状态、按钮）
**每行操作**
- 成功：预览/下载/进入质检
- 失败：显示错误摘要 + 【重试本张】

#### S3-3：质检（Review）
**布局**
- 左：Shot 列表（01→N，显示状态与缩略图；可快速切换）
- 右：大图对比区（参考图 vs 当前输出图，支持放大）
- 下：操作区【通过】【需要修复】【重生本张】

#### S3-4：修复弹窗（Fix Modal）
**结构**
- 顶部：标题“仅修复衣服细节（其它保持不变）”
- 三栏对比：参考图 / 当前图 / GARMENT LOCK（可编辑）
- Step1：生成修复方案
  - 输出：不一致清单（可勾选）、修复指令（英文，可编辑）
  - 按钮：【生成修复方案】、【复制修复指令】
- Step2：执行修复
  - 按钮：【执行修复】
  - 成功：展示新版本对比 + 【通过】【继续修复】【回退旧版】
**关键默认句（展示给用户可编辑）**
- “Keep the model face, pose, background, lighting and camera unchanged; only correct the garment to match the reference images and the GARMENT LOCK items.”

#### S3-5：导出（Export）
- 【下载全部】（打包：图片 + Shot List + Prompts + 参数 + 版本记录）
- 单张下载

### S4：设置（Settings）
**目的**：让不懂代码的人也能配置可用的调用  
**字段**
- Base URL（你的网关域名）
- API Key（密码框）
- 默认模型：看图/思考（text+vision）与 生图/改图（image）分开选择（可默认隐藏高级设置）
- 默认输出：比例（默认 9:16）、清晰度（默认 2K/或 1080x1920）
- 【测试连接】按钮：返回成功/失败原因
**提示**
- “本工具仅在本机使用，Key 将保存在本地（可随时清除）”

## 5. 全局状态与错误文案（统一）
- 通用 loading：`正在生成...`
- 通用失败：`失败：{原因}（可重试）`
- 连接失败（设置页）：`无法连接到接口，请检查 Base URL / Key / 网络`
- 成本提示（可选）：`本次操作将产生调用费用（按接口计费）`

## 6. 交接备注（给 UI）
- 视觉风格建议：偏“工具型 Admin”（高密度表格 + 清晰状态 + 大图预览）
- 重点做“参考图与输出图对比”的易用性：放大、并排、快速切换 Shot
- GARMENT LOCK 的编辑体验要轻：类似 Tag/Checklist，支持排序
