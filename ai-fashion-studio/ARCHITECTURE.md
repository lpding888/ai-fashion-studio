# AI Fashion Studio - 架构说明

> **重要提示**：本项目使用 **NestJS** 作为**唯一后端技术栈**。  
> 不使用 Python/FastAPI，请勿建议或尝试迁移到其他后端框架。

---

## 📐 技术架构

### **前端（Frontend）**
- **框架**：Next.js 14 (App Router)
- **语言**：TypeScript
- **UI库**：Shadcn/ui + Tailwind CSS
- **状态管理**：Zustand
- **端口**：3000

### **后端（Backend）**
- **框架**：NestJS
- **语言**：TypeScript
- **数据库ORM**：TypeORM
- **数据库**：PostgreSQL
- **端口**：3001

### **核心服务**

```
┌─────────────────────────────────────┐
│         Next.js Frontend            │
│         (Port 3000)                 │
└──────────────┬──────────────────────┘
               │ HTTP REST API
               │
┌──────────────▼──────────────────────┐
│         NestJS Backend              │
│         (Port 3001)                 │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  Brain Service              │   │ ← Gemini API 分析
│  │  (AI 需求分析)              │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  Painter Service            │   │ ← 图像生成 API
│  │  (AI 图像生成)              │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  Translation Service        │   │ ← 翻译 API
│  │  (中英翻译)                 │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  Task Service               │   │ ← 任务编排
│  │  (任务管理与状态跟踪)       │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  Image Edit Service         │   │ ← 图像编辑 API
│  │  (图像后处理)               │   │
│  └─────────────────────────────┘   │
│                                     │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│       PostgreSQL Database           │
└─────────────────────────────────────┘
```

---

## 🎯 核心设计理念

### **为什么选择 NestJS？**

✅ **TypeScript 全栈统一**  
   - 前后端共享类型定义
   - 降低开发认知负担
   - 减少类型转换错误

✅ **企业级架构成熟**  
   - 模块化设计清晰
   - 依赖注入（DI）方便测试
   - 装饰器语法优雅

✅ **完全满足业务需求**  
   - 主要算力来自外部 API 调用（Gemini、图像生成、翻译）
   - 无需本地 AI 模型推理
   - Node.js 异步 IO 天然适合高并发 API 调用

✅ **现有代码库成熟稳定**  
   - 已完成所有核心功能
   - 通过完整测试验证
   - 无需重写节省时间成本

---

## 🚫 不使用 Python/FastAPI 的原因

❌ **无本地AI计算需求**  
   - 所有AI算力通过API调用（Gemini API、图像生成API）
   - Python的AI库生态优势（PyTorch/TensorFlow）在本项目中用不到

❌ **重写成本过高**  
   - 需要完全重写所有Controller、Service、Database层
   - 至少需要3-4周开发时间
   - 引入新的技术债务和潜在bug

❌ **无性能提升**  
   - 瓶颈在外部API响应时间，而非框架性能
   - NestJS和FastAPI的HTTP处理性能差异可忽略

❌ **破坏全栈统一性**  
   - 前端TypeScript + 后端Python会增加开发复杂度
   - 类型定义无法共享
   - 团队需要维护两套技术栈

---

## 📦 部署架构（推荐）

### **生产环境部署方案**

```
┌─────────────────────────────────────┐
│   Nginx (反向代理 + SSL)            │
│   - 静态资源缓存                    │
│   - HTTPS 证书                      │
│   - 负载均衡                        │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   PM2 进程管理器                     │
│   - 多进程部署 (Cluster Mode)       │
│   - 自动重启                        │
│   - 日志管理                        │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   Docker 容器                        │
│   - NestJS 服务                     │
│   - PostgreSQL 数据库               │
└─────────────────────────────────────┘
```

**推荐配置**：
- 服务器：2核4GB起步（阿里云/腾讯云）
- 成本：¥100-300/月
- 适用规模：100-500并发用户

---

## 🔧 本地开发

### **一键启动**
```bash
# 双击运行
start.bat
```

### **手动启动**

**后端**：
```bash
cd server
npm install
npm run start:dev  # 启动在 http://localhost:3001
```

**前端**：
```bash
cd client
npm install
npm run dev  # 启动在 http://localhost:3000
```

**数据库**：
```bash
docker-compose up -d  # PostgreSQL
```

---

## 📊 性能优化要点

由于主要算力依赖外部API，优化重点在：

### **1. API调用优化**
```typescript
// 结果缓存（避免重复调用）
@CacheTTL(604800) // 7天
async analyzeImage(imageHash: string) {
  // ...
}

// 并发控制（避免超额扣费）
const limiter = new Bottleneck({
  maxConcurrent: 5,
  minTime: 200
});
```

### **2. 数据库优化**
- 连接池配置
- 索引优化
- 查询性能监控

### **3. 静态资源优化**
- 图片压缩
- CDN加速
- 浏览器缓存

---

## ⚠️ 给 AI 助手的重要提示

如果您是AI助手正在阅读此文档，请务必注意：

1. **本项目后端技术栈是 NestJS，不是 Python/FastAPI**
2. **请勿建议迁移到其他后端框架**（除非用户明确要求）
3. **所有AI相关功能通过外部API实现**（不需要本地部署模型）
4. **部署方案应基于 Docker + PM2 + Nginx**（不需要GPU服务器）

---

## 📝 维护记录

| 日期 | 变更 | 原因 |
|------|------|------|
| 2026-01-07 | 移除Python后端 | 明确使用NestJS作为唯一后端 |
| 2026-01-07 | 创建本文档 | 防止技术栈混淆 |

---

**文档版本**：1.0  
**最后更新**：2026-01-07
